version: '3'

services:
  plex:
    image: plexinc/pms-docker
    networks:
    - web
    ports:
    - 32400:32400
    # DLNA (uncomment if you need DLNA)
    # - "32469:32469"
    # - "1900:1900/udp"
    environment:
    - PLEX_CLAIM="${PLEX_TOKEN}"
    - ADVERTISE_IP="https://plex.${DOMAIN_NAME}/"
    - PLEX_UID=${USER_ID}
    - PLEX_GID=${GROUP_ID}
    volumes:
    - /etc/localtime:/etc/localtime:ro
    - ./media/couchpotato/movies:/data/movies
    - ./media/sonarr/series:/data/tvshows
    - ./media/plex/config/:/config
    - /tmp/transcode/:/transcode
    labels:
    - "traefik.enable=true"
    - "traefik.backend=plex"
    - "traefik.frontend.rule=Host:plex.${DOMAIN_NAME}"
    - "traefik.port=32400"
    - "traefik.docker.network=web"
    depends_on:
    - transmission
    - sonarr
    - couchpotato

  transmission:
    image: linuxserver/transmission
    networks:
    - web
    ports:
    - "51413:51413"
    - "51413:51413/udp"
    environment:
    - PUID=${USER_ID}
    - PGID=${GROUP_ID}
    volumes:
    - /etc/localtime:/etc/localtime:ro
    - ./media/transmission/config/:/config
    - ./media/transmission/downloads/:/downloads
    labels:
    - "traefik.enable=true"
    - "traefik.backend=transmission"
    - "traefik.frontend.rule=Host:transmission.${DOMAIN_NAME}"
    - "traefik.port=9091"
    - "traefik.docker.network=web"

  sonarr:
    image: linuxserver/sonarr
    networks:
    - web
    volumes:
    - /dev/rtc:/dev/rtc:ro
    - ./media/sonarr/series:/tv
    - ./media/sonarr/config:/config
    - ./media/transmission/downloads/:/downloads
    environment:
    - PUID=${USER_ID}
    - PGID=${GROUP_ID}
    labels:
    - "traefik.enable=true"
    - "traefik.backend=sonarr"
    - "traefik.frontend.rule=Host:sonarr.${DOMAIN_NAME}"
    - "traefik.port=8989"
    - "traefik.docker.network=web"
    depends_on:
    - transmission

  couchpotato:
    image: linuxserver/couchpotato
    networks:
    - web
    volumes:
    - /dev/rtc:/dev/rtc:ro
    - ./media/couchpotato/movies:/movies
    - ./media/couchpotato/config/:/config
    - ./media/transmission/downloads/:/downloads
    environment:
    - PUID=${USER_ID}
    - PGID=${GROUP_ID}
    labels:
    - "traefik.enable=true"
    - "traefik.backend=couchpotato"
    - "traefik.frontend.rule=Host:couchpotato.${DOMAIN_NAME}"
    - "traefik.port=5050"
    - "traefik.docker.network=web"
    depends_on:
    - transmission

  # uncomment to enable torznab as a T411 proxy for sonarr
  # torznab's image will need to be built
  # t411proxy:
  #   build: ../T411-Torznab
  #   networks:
  #   - web
  #   environment:
  #   - USERNAME="${T411USERNAME}"
  #   - PASSWORD="${T411PASSWORD}"

  # Sonarr to... a bunch of public trackers!
  jackett:
    image: "linuxserver/jackett:45"
    networks:
    - web
    volumes:
    - ./media/jackett/config/:/config
    - ./media/transmission/downloads/:/downloads
    environment:
    - PUID=${USER_ID}
    - PGID=${GROUP_ID}
    ports:
    - 9117
    labels:
    - "traefik.enable=true"
    - "traefik.backend=jackett"
    - "traefik.frontend.rule=Host:jackett.${DOMAIN_NAME}"
    - "traefik.port=9117"
    - "traefik.docker.network=web"

networks:
  web:
    external:
      name: reverseproxy_default
